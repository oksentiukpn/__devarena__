{% extends "base.html" %}

{% block title %}Settings{% endblock %}

{% block content %}

<main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

  <div class="flex items-center gap-2 mb-8">
    <h1 class="text-2xl font-medium text-white tracking-wide">Settings</h1>
  </div>

  <div class="bg-zinc-900/80 rounded-full p-1.5 mb-8 inline-flex flex-wrap items-center gap-1 border border-zinc-800">
    <a href="#profile" class="tab-link px-9 py-2 rounded-full bg-zinc-800 text-emerald-500 font-medium text-sm transition-colors">profile</a>
    <a href="#account" class="tab-link px-9 py-2 rounded-full text-zinc-300 hover:text-white hover:bg-zinc-800/50 font-medium text-sm transition-colors">account</a>
    <a href="#notifications" class="tab-link px-9 py-2 rounded-full text-zinc-300 hover:text-white hover:bg-zinc-800/50 font-medium text-sm transition-colors">notifications</a>
    <a href="#privacy" class="tab-link px-9 py-2 rounded-full text-zinc-300 hover:text-white hover:bg-zinc-800/50 font-medium text-sm transition-colors">privacy</a>
    <a href="#defaults" class="tab-link px-9 py-2 rounded-full text-zinc-300 hover:text-white hover:bg-zinc-800/50 font-medium text-sm transition-colors">defaults</a>
    <a href="#danger" class="tab-link px-9 py-2 rounded-full text-zinc-300 hover:text-white hover:bg-zinc-800/50 font-medium text-sm transition-colors">danger</a>
  </div>

  <div id="tab-contents">

    {% set u = user if user is defined else current_user %}

    <div id="profile" class="tab-content hidden text-white w-full space-y-6">
      <h2 class="text-xl font-medium text-white mb-4">Profile</h2>

      <div class="flex items-center gap-4 mb-2">
        <div class="w-12 h-12 rounded-full bg-gradient-to-br from-emerald-500 to-teal-700 flex items-center justify-center text-xl font-bold text-white shadow-lg shadow-emerald-900/20 overflow-hidden">
          {# If image_file is a URL or a local filename, try to show it. If missing, show initial. #}
          {% if u and u.image_file %}
            {% if u.image_file.startswith('http') %}
              <img src="{{ u.image_file }}" alt="Profile picture" class="w-full h-full object-cover">
            {% else %}
              <img
                src="{{ url_for('static', filename='profile_pics/' ~ u.image_file) }}"
                alt="Profile picture"
                class="w-full h-full object-cover"
                onerror="this.remove();"
              >
              <!-- <span class="fallback-initial">
                {{ u.username[:1].upper() if u and u.username else 'U' }}
              </span> -->
            {% endif %}
          <!-- {% else %}
            {{ u.username[:1].upper() if u and u.username else 'U' }}
          {% endif %} -->
        </div>

        <label for="profile_picture"
          class="px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-zinc-200 rounded-full text-sm font-medium transition-colors border border-zinc-700/50 cursor-pointer">
          Upload new picture
        </label>
      </div>

      <div class="bg-zinc-900/50 border border-zinc-800 rounded-2xl p-6 md:p-8">
        <form
          action="{{ url_for('main.profile_save_changes') }}"
          method="POST"
          enctype="multipart/form-data"
          id="settings_name_bio"
        >
          {# hidden input triggered by label above #}
          <input id="profile_picture" name="profile_picture" type="file" accept="image/*" class="hidden">

          <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 mb-6">
            <div>
              <label for="username" class="block text-base font-medium text-white mb-2">Username</label>
              <input
                name="username"
                type="text"
                id="username"
                placeholder="@username"
                value="{{ u.username if u and u.username else '' }}"
                class="w-full bg-zinc-800 border-none rounded-[15px] py-2 px-5 text-sm text-zinc-400 placeholder-zinc-500 focus:outline-none focus:ring-1 focus:ring-emerald-500 transition-all resize-none shadow-inner leading-relaxed"
              >
            </div>
          </div>

          <div class="mt-6">
            <label for="bio" class="block text-base font-medium text-white mb-2">Bio</label>
            <textarea
              id="bio"
              name="bio"
              rows="5"
              placeholder="Tell us about yourself..."
              class="w-full bg-zinc-800 border-none rounded-[20px] py-4 px-5 text-sm text-zinc-400 placeholder-zinc-500 focus:outline-none focus:ring-1 focus:ring-emerald-500 transition-all resize-none shadow-inner leading-relaxed"
            >{{ u.bio if u and u.bio else '' }}</textarea>
          </div>

          <div class="mt-8 flex justify-end">
            <button type="submit" class="px-6 py-2.5 bg-emerald-600 hover:bg-emerald-500 text-white font-medium rounded-lg transition-colors">
              Save Changes
            </button>
          </div>

        </form>
      </div>
    </div>

    <div id="account" class="tab-content hidden text-white">
      <p>account</p>
    </div>

    <div id="notifications" class="tab-content hidden text-white">
      <p>notifications</p>
    </div>

    <div id="privacy" class="tab-content hidden text-white">
      <p>privacy</p>
    </div>

    <div id="defaults" class="tab-content hidden text-white">
      <p>defaults</p>
    </div>

    <div id="danger" class="tab-content hidden text-white">
      <p>danger</p>
    </div>

  </div>

  <script>
    // Active/inactive Tailwind classes from your snippet
    const activeClasses = ['bg-zinc-800', 'text-emerald-500'];
    const inactiveClasses = ['text-zinc-300', 'hover:text-white', 'hover:bg-zinc-800/50'];

    function updateTabs() {
      const currentHash = window.location.hash || '#profile';

      // Update nav buttons
      const links = document.querySelectorAll('.tab-link');
      links.forEach(link => {
        const isTarget = link.getAttribute('href') === currentHash;

        if (isTarget) {
          link.classList.remove(...inactiveClasses);
          link.classList.add(...activeClasses);
        } else {
          link.classList.remove(...activeClasses);
          link.classList.add(...inactiveClasses);
        }
      });

      // Update content sections
      const contents = document.querySelectorAll('.tab-content');
      contents.forEach(content => {
        if (content.id === currentHash.substring(1)) {
          content.classList.remove('hidden');
        } else {
          content.classList.add('hidden');
        }
      });
    }

    window.addEventListener('DOMContentLoaded', updateTabs);
    window.addEventListener('hashchange', updateTabs);
  </script>

</main>
{% endblock %}
